#!/usr/bin/env ruby# -*- coding: utf-8 -*-## Sango(クラウドのMQTT Broker)にデータをPublishするrequire 'mqtt'require 'json'# Raspberry PiのCPU温度temp_s = File.read("/sys/class/thermal/thermal_zone0/temp")temp = temp_s.to_f / 1000# Sangoへの接続情報定義sango_config = {  'host' => 'lite.mqtt.shiguredo.jp',  'port' => 1883,  'username' => 'riku742652@github',  'password' => 'tIYYfq2cX4MODQjd',  'access_topic' => 'riku742652@github',}# 自分のホスト名(Sangoにpublishする際の自ホスト名となる)myname = "myraspi1"# SangoへのMQTT接続sango = MQTT::Client.connect(:remote_host => sango_config['host'],                             :remote_port => sango_config['port'],                             :username => sango_config['username'],                             :password => sango_config['password'])# Publishするデータ作成# publishするデータはJSON形式とする# {#    type: 'temperature',#    sensor: 自ホスト名#    temper : 温度データ#    cputemp : CPU温度# }topic = sango_config['access_topic'] + '/' + 'temper'json = {type: 'temperature', sensor: "myraspi1", temper: temp}.to_jsonsango.publish(topic, json)
